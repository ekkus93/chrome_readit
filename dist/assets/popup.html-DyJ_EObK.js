import{c as R,j as t,r as s}from"./client-BCr4-QWM.js";import{g as k,s as L}from"./storage-uVl3v7f4.js";function C(){const[m,x]=s.useState([]),[c,d]=s.useState(1),[v,h]=s.useState(),[p,o]=s.useState(null),[u,S]=s.useState("Hello from the popup"),[a,i]=s.useState("idle");s.useEffect(()=>{const e=()=>x(window.speechSynthesis.getVoices());if(e(),speechSynthesis.onvoiceschanged===null)return speechSynthesis.addEventListener("voiceschanged",e),()=>speechSynthesis.removeEventListener("voiceschanged",e);speechSynthesis.onvoiceschanged=e},[]),s.useEffect(()=>{k().then(e=>{d(e.rate),h(e.voice)})},[]),s.useEffect(()=>{let e=!0;const n=()=>{try{chrome.runtime.sendMessage({action:"probe-tts"},r=>{e&&(r&&r.ok?o(!0):o(!1))})}catch(r){if(!e)return;console.warn("readit: probe-tts failed",r),o(!1)}};n();const g=()=>n();return window.addEventListener("focus",g),()=>{e=!1,window.removeEventListener("focus",g)}},[]);async function T(){try{await chrome.runtime.sendMessage({kind:"READ_SELECTION"})}catch(e){console.warn("readit: failed to request background read",e)}}async function b(){const e=(u||"").trim();if(e){i("sending");try{await chrome.runtime.sendMessage({kind:"READ_TEXT",text:e}),i("ok"),setTimeout(()=>i("idle"),1200)}catch(n){console.warn("readit: try speech failed",n),i("error")}}}async function y(e){await L(e)}const l={display:"block",fontWeight:600},j={width:"100%",padding:"12px",fontSize:"1rem"},E={width:"100%",padding:8},w={width:"100%"};return t.jsxs("div",{role:"application",style:{minWidth:280,padding:12,lineHeight:1.4},children:[t.jsx("h1",{style:{fontSize:"1.1rem",margin:"0 0 8px"},children:"Read It"}),t.jsx("button",{onClick:T,"aria-label":"Read selected text",style:j,children:"Read selection (Alt+Shift+R)"}),t.jsxs("div",{style:{marginTop:12},children:[t.jsx("label",{htmlFor:"voice",style:l,children:"Voice"}),t.jsxs("select",{id:"voice",value:v??"",onChange:e=>{h(e.target.value||void 0),y({voice:e.target.value||void 0})},style:E,children:[t.jsx("option",{value:"",children:"System default"}),m.map(e=>t.jsxs("option",{value:e.name,children:[e.name," ",e.lang?`(${e.lang})`:""]},e.name))]})]}),t.jsxs("div",{style:{marginTop:12},children:[t.jsxs("label",{htmlFor:"rate",style:l,children:["Rate: ",c.toFixed(2)]}),t.jsx("input",{id:"rate",type:"range",min:.5,max:2,step:.05,value:c,onChange:e=>{const n=Number(e.target.value);d(n),y({rate:n})},style:w})]}),t.jsxs("section",{style:{marginTop:12},children:[t.jsx("label",{htmlFor:"tryText",style:l,children:"Try speech on current page"}),t.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[t.jsx("input",{id:"tryText",value:u,onChange:e=>S(e.target.value),style:{flex:1,padding:8}}),t.jsx("button",{onClick:b,style:{padding:"8px 12px"},children:a==="sending"?"Sendingâ€¦":"Try speech"})]}),a==="ok"&&t.jsx("div",{style:{color:"#006400",marginTop:8},children:"Requested speech on the active tab."}),a==="error"&&t.jsx("div",{style:{color:"#8b0000",marginTop:8},children:"Failed to request speech. See background console."})]}),t.jsx("p",{style:{fontSize:".85rem",marginTop:12},children:"Tip: Everything here is fully keyboard accessible. Use Tab / Shift+Tab to move, Space/Enter to activate."}),p===!1&&t.jsx("div",{style:{marginTop:12,padding:8,background:"#fff4f4",color:"#8b0000",borderRadius:4},children:"Local TTS helper not running. Start the helper (see project scripts/README.md) if you rely on local system voices."}),p===!0&&t.jsx("div",{style:{marginTop:12,padding:8,background:"#f4fff7",color:"#006400",borderRadius:4},children:"Local TTS helper available."})]})}const f=document.getElementById("root");f&&R.createRoot(f).render(t.jsx(C,{}));
