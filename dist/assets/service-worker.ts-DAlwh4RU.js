async function c(){const[e]=await chrome.tabs.query({active:!0,currentWindow:!0});return!e?.id||!e.url||!/^https?:|^file:/.test(e.url)?null:e}async function r(e){const t=await c();if(!t){console.warn("[readit] No eligible tab (http/https/file) to inject into.");return}try{await chrome.tabs.sendMessage(t.id,e)}catch{await chrome.scripting.executeScript({target:{tabId:t.id},world:"MAIN",func:()=>{window.__readit_listener_installed__||(window.__readit_listener_installed__=!0,chrome.runtime.onMessage.addListener(n=>{if(n&&n.kind==="READ_SELECTION"){const i=window.getSelection()?.toString().trim();if(i){const a=new SpeechSynthesisUtterance(i);speechSynthesis.cancel(),speechSynthesis.speak(a)}}}))}}),await chrome.tabs.sendMessage(t.id,e)}}chrome.commands.onCommand.addListener(async e=>{e==="read-selection"&&await r({kind:"READ_SELECTION"})});chrome.runtime.onInstalled.addListener(()=>{chrome.contextMenus&&chrome.contextMenus.create({id:"read-selection",title:"Read selection aloud",contexts:["selection"]})});chrome.contextMenus?.onClicked&&chrome.contextMenus.onClicked.addListener(async e=>{e.menuItemId==="read-selection"&&await r({kind:"READ_SELECTION"})});
