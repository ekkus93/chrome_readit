import{r as n,j as t,c as E}from"./client-BCr4-QWM.js";const k={rate:1};async function S(){const r=await chrome.storage.sync.get(["settings"]);return{...k,...r.settings??{}}}async function x(r){const p=await S();await chrome.storage.sync.set({settings:{...p,...r}})}function V(){const[r,p]=n.useState([]),[c,u]=n.useState(""),[l,y]=n.useState(1),[d,f]=n.useState(!1),[g,v]=n.useState("Hello — this is a quick test of Read It."),[h,i]=n.useState("idle"),[w,a]=n.useState(null);n.useEffect(()=>{const e=()=>p(window.speechSynthesis.getVoices());e();const s=()=>e();return window.speechSynthesis.addEventListener("voiceschanged",s),()=>window.speechSynthesis.removeEventListener("voiceschanged",s)},[]),n.useEffect(()=>{S().then(e=>{y(e.rate),u(e.voice??""),f(!0)})},[]),n.useEffect(()=>{d&&x({rate:l})},[l,d]),n.useEffect(()=>{d&&x({voice:c||void 0})},[c,d]);const j=n.useMemo(()=>[{name:"",label:"System default"}],[]).concat(r.map(e=>({name:e.name,label:`${e.name}${e.lang?` (${e.lang})`:""}`})));async function m(e){try{const s=new SpeechSynthesisUtterance(e);if(s.rate=l??1,c){const o=window.speechSynthesis.getVoices().find(b=>b.name===c);o&&(s.voice=o)}window.speechSynthesis.cancel(),window.speechSynthesis.speak(s),i("fallback"),a(null)}catch(s){i("error"),a(String(s))}}function T(){const e=(g||"").trim();if(e){i("sending"),a(null);try{chrome.runtime.sendMessage({action:"proxy-speak",text:e},s=>{if(s&&s.ok){i("ok"),a(null);return}const o=window.speechSynthesis.getVoices();if(!o||o.length===0){i("error"),a("No system voices available; start the local TTS helper (see scripts/README.md)");return}m(e)})}catch(s){const o=window.speechSynthesis.getVoices();o&&o.length>0?m(e):(i("error"),a(String(s)))}}}return t.jsxs("main",{style:{maxWidth:720,padding:24,lineHeight:1.5},children:[t.jsx("h1",{style:{marginTop:0},children:"Read It – Options"}),t.jsxs("section",{style:{marginBottom:24},children:[t.jsx("label",{htmlFor:"voice",style:{display:"block",fontWeight:600,marginBottom:8},children:"Voice"}),t.jsx("select",{id:"voice",value:c,onChange:e=>u(e.target.value),style:{width:360,padding:8},children:j.map(e=>t.jsx("option",{value:e.name,children:e.label},e.name||"default"))}),t.jsx("p",{style:{color:"GrayText"},children:"Choose a TTS voice. Availability depends on your OS and browser."})]}),t.jsxs("section",{children:[t.jsxs("label",{htmlFor:"rate",style:{display:"block",fontWeight:600,marginBottom:8},children:["Speech rate: ",l.toFixed(2)]}),t.jsx("input",{id:"rate",type:"range",min:.5,max:2,step:.05,value:l,onChange:e=>y(Number(e.target.value)),style:{width:360}}),t.jsx("div",{style:{color:"GrayText"},children:"0.5 (slow) … 2.0 (fast)"})]}),t.jsxs("section",{style:{marginTop:24},children:[t.jsx("label",{htmlFor:"test",style:{display:"block",fontWeight:600,marginBottom:8},children:"Test speech"}),t.jsx("textarea",{id:"test",rows:3,value:g,onChange:e=>v(e.target.value),style:{width:520,padding:8}}),t.jsxs("div",{style:{marginTop:8},children:[t.jsx("button",{onClick:T,style:{padding:"8px 12px"},children:"Test speech"}),t.jsxs("span",{style:{marginLeft:12},children:[h==="sending"&&"Sending…",h==="ok"&&t.jsx("span",{style:{color:"#006400"},children:" Spoken via local helper"}),h==="fallback"&&t.jsx("span",{style:{color:"#006400"},children:" Spoken via browser TTS"}),h==="error"&&t.jsxs("span",{style:{color:"#8b0000"},children:[" Error: ",w]})]})]})]})]})}const L=E.createRoot(document.getElementById("root"));L.render(t.jsx(V,{}));
